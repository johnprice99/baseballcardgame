<!DOCTYPE html>
<html lang="en" ng-app="bbcgApp">
    <head>
        <meta charset="UTF-8" />
        <title>BBCG</title>

		<link rel="stylesheet" href="/public/css/wireframe.css" />
		<!--link rel="stylesheet" href="/public/css/main.css" /-->
    </head>
    <body ng-controller="GameCtrl">
		<section id="container">
			<section id="board">
				<section id="field">
					<section id="dirt" class="sand"></section>
					<section id="diamond">
						<section id="first" ng-class="{ hasRunner : game.bases[0] == 1}" class="base">1</section>
						<section id="second" ng-class="{ hasRunner : game.bases[1] == 1}" class="base">2</section>
						<section id="third" ng-class="{ hasRunner : game.bases[2] == 1}" class="base">3</section>
						<section id="homePlate" class="base hasRunner">4</section>
						<section id="mound" class="sand"><section id="rubber"></section></section>
   
						<!--span ng-switch on="myRole">
							<section ng-switch-when="batter">
								<button type="button" id="stealSecond" ng-class="{ visible : game.bases[0] == 1 && game.bases[1] == 0 }" class="button stealButton" ng-click="stealBase(2)">Steal 2nd</button>
								<button type="button" id="stealThird" ng-class="{ visible : game.bases[1] == 1 && game.bases[2] == 0 }" class="button stealButton" ng-click="stealBase(3)">Steal 3rd</button>
								<button type="button" id="stealSecondAndThird" ng-class="{ visible : game.bases[0] == 1 && game.bases[1] == 1 && game.bases[2] == 0 }" class="button stealButton" ng-click="stealBase(5)">Double Steal (2nd &amp; 3rd)</button>
								<button type="button" id="stealHome" ng-class="{ visible : game.bases[2] == 1 }" class="button stealButton" ng-click="stealBase(4)">Steal Home</button>
							</section>
						</span-->
					</section>
				</section>

				<section id="scoreboard">
					<ul id="headers" class="clearfix">
						<li>1</li>
						<li>2</li>
						<li>3</li>
						<li>4</li>
						<li>5</li>
						<li>6</li>
						<li>7</li>
						<li>8</li>
						<li>9</li>
						<li>R</li>
					</ul>

					<p id="awayTeamLabel" class="left highlight">Visitor</p>
					<ul id="visitor" class="clearfix">
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
					</ul>

					<p id="homeTeamLabel" class="left">Home</p>
					<ul id="home" class="clearfix">
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
						<li>0</li>
					</ul>

					<section class="right clearfix">
						<p class="left">Out</p>
						<ul id="outs" class="left clearfix">
							<li class="out">O</li>
							<li>O</li>
						</ul>
					</section>

					<section class="left clearfix">
						<p class="left">Inn</p>
						<ul class="left">
							<li id="inning">1</li>
							<li id="teamOnOffense" class="away"></li>
						</ul>
					</section>
				</section>

				<!--span ng-switch on="myRole">
					<section ng-switch-when="batter" ng-include="'public/partials/batter.html'"></section>
					<section ng-switch-when="pitcher" ng-include="'public/partials/pitcher.html'"></section>
				</span-->
				
				<section id="playerCards">
					<ul class="clearfix">
						<li><section class="card back"></section></li>
						<li><section class="card back"></section></li>
						<li><section class="card back"></section></li>
						<li><section class="card back"></section></li>
						<li><section class="card back"></section></li>

						<!--li><section class="card">3</section></li>
						<li><section class="card">9</section></li>
						<li><section class="card">7</section></li>
						<li><section class="card back pack"></section></li-->
					</ul>
					<!--h4>Waiting for pitcher...</h4-->
				</section>

				<ul id="selectedCards" class="clearfix">
					<li id="pitcherCard" class="left"><section class="card"></section></li>
					<li id="batterCard" class="right"><section class="card"></section></li>
				</ul>

				<section id="messageBox"></section>
			</section>
		</section>

		
		<script src="/socket.io/socket.io.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
		<script>
			Array.prototype.sum = function() {
				return this.reduce(function(a,b){return a+b;});
			};
		</script>
		
		
		<script>


			var socket = io.connect('http://localhost:1337');
			socket.on('consoleMessage', function(msg){
				console.log(msg);
			});
			
			var app = angular.module('bbcgApp', []);

			app.factory('socket', function ($rootScope) {
				var socket = io.connect();
				return {
					on: function (eventName, callback) {
						socket.on(eventName, function () {
							var args = arguments;
							$rootScope.$apply(function () {
								callback.apply(socket, args);
							});
						});
					},
					emit: function (eventName, data, callback) {
						socket.emit(eventName, data, function () {
							var args = arguments;
							$rootScope.$apply(function () {
								if (callback) {
									callback.apply(socket, args);
								}
							});
						})
					}
				};
			});


			/*
			 * TODO
			 *
			 * Clean up the frontend code with the wireframe design
			 * move angular/socket and common code into central location
			 * Add win graphics that appear when winner, and home run graphics too?
			 * Add a refresh check to make sure people do not accidentally refresh the browser
			 * Make the disconnect end the game for both players - the team that didn't disconnect will "win"
			 * Slow the game down a bit - decisions seem to be too fast
			 * Change it so that there can be multiple games going - if both players disconnect, remove the game from the server
			 * 
			 * Allow the user to name their team for the game (and colour of deck/playing pieces)
			 * Add a span to represent the runner on base - animate them when they score
			 * Add a span to represent the ball and animate it to where it goes on the play
			 * Add the ability for users to roll their own dice
			 * Store the team in a database in the backend - show standings based on player locality (UK, USA, Kent UK leagues etc)
			 *
			 */
			function GameCtrl($scope, socket) {
				socket.on('displayMessage', function(message) {
					console.log(message.text);
					/*$('#messageBox').append('<p class="'+type+'">'+message+'</p>').animate({
					scrollTop:$("#messageBox")[0].scrollHeight
					}, 1000);*/
				});
				
				socket.on('updateGameModel', function(game) {
					$scope.game = game;
				});
				
				socket.on('updateRole', function(role) {
					$scope.myRole = role;
				});
				
				/*----- User interaction events -----*/
				
				$scope.selectPitcherCard = function(index) {
					if (!$scope.game.gameover && !$scope.game.pitcherReady) { //prevent double clicking
						socket.emit('throwPitch', { index: index });
					}
				}
				
				$scope.selectBatterCard = function(index) {
					if (!$scope.game.gameover && $scope.game.pitcherReady) {
						socket.emit('swingBat', { index: index });
					}
				};
				
				$scope.stealBase = function(base) {
					socket.emit('stealBase', { base: base });
				}
			}
		</script>
    </body>
</html>