<!DOCTYPE html>
<html lang="en" ng-app="bbcgApp">
    <head>
        <meta charset="UTF-8" />
        <title>BBCG</title>

		<link rel="stylesheet" href="/css/wireframe.css" />
		<!--link rel="stylesheet" href="/css/main.css" /-->
    </head>
    <body ng-controller="GameCtrl" ng-cloak>
		<section id="container">
			<section id="controlCenter">
				<button type="button" onclick="createGame();">Create a new game</button>
				<p>or</p>
				<input type="phone" id="gameID" placeholder="Game ID" maxlength="5" />
				<button type="button" onclick="joinGame();">Join an existing game</button>
			</section>
		
			<section id="board" style="display:none;">
				<section id="field">
					<section id="dirt" class="sand"></section>
					<section id="diamond">
						<section id="first" ng-class="{ hasRunner : game.bases[0] == 1}" class="base">1</section>
						<section id="second" ng-class="{ hasRunner : game.bases[1] == 1}" class="base">2</section>
						<section id="third" ng-class="{ hasRunner : game.bases[2] == 1}" class="base">3</section>
						<section id="homePlate" class="base hasRunner">4</section>
						<section id="mound" class="sand"><section id="rubber"></section></section>
   
						<span ng-switch on="myRole">
							<section ng-switch-when="batter">
								<button type="button" id="stealSecond" ng-class="{ visible : game.bases[0] == 1 && game.bases[1] == 0 }" class="button stealButton" ng-click="stealBase(2)">Steal 2nd</button>
								<button type="button" id="stealThird" ng-class="{ visible : game.bases[1] == 1 && game.bases[2] == 0 }" class="button stealButton" ng-click="stealBase(3)">Steal 3rd</button>
								<button type="button" id="stealSecondAndThird" ng-class="{ visible : game.bases[0] == 1 && game.bases[1] == 1 && game.bases[2] == 0 }" class="button stealButton" ng-click="stealBase(5)">Double Steal (2nd &amp; 3rd)</button>
								<button type="button" id="stealHome" ng-class="{ visible : game.bases[2] == 1 }" class="button stealButton" ng-click="stealBase(4)">Steal Home</button>
							</section>
						</span>
					</section>
				</section>

				<section id="scoreboard">
					<ul id="headers" class="clearfix">
						<li>1</li>
						<li>2</li>
						<li>3</li>
						<li>4</li>
						<li>5</li>
						<li>6</li>
						<li>7</li>
						<li>8</li>
						<li>9</li>
						<li>R</li>
					</ul>
					
					<p id="awayTeamLabel" ng-class="{ highlight : myTeam == 'away' }" class="left">Visitor</p>
					<ul id="visitor" class="clearfix">
						<li ng-repeat="score in game.scores.away">{{score}}</li>
						<li>{{game.scores.away.sum()}}</li>
					</ul>

					<p id="homeTeamLabel" ng-class="{ highlight : myTeam == 'home' }" class="left">Home</p>
					<ul id="home" class="clearfix">
						<li ng-repeat="score in game.scores.home">{{score}}</li>
						<li>{{game.scores.home.sum()}}</li>
					</ul>

					<section class="right clearfix">
						<p class="left">Out</p>
						<ul id="outs" class="left clearfix">
							<li ng-class="{ out : game.outs >= 1 }">O</li>
							<li ng-class="{ out : game.outs == 2 }">O</li>
						</ul>
					</section>

					<section class="left clearfix">
						<p class="left">Inn</p>
						<ul class="left">
							<li id="inning">{{game.currentInning}}</li>
							<li id="teamOnOffense" ng-class="game.teamOnOffense"></li>
						</ul>
					</section>
				</section>

				<section id="playerCards" ng-switch on="myRole">
					<section ng-switch-when="batter" ng-include="'/partials/batter.html'"></section>
					<section ng-switch-when="pitcher" ng-include="'/partials/pitcher.html'"></section>
				</section>

				<ul id="selectedCards" class="clearfix">
					<li id="pitcherCard" class="left"><section class="card">{{game.pitcherCard.value}}</section></li>
					<li id="batterCard" class="right"><section class="card">{{game.batterCard.value}}</section></li>
				</ul>
				
				<section id="messageBox" scroll-glue><p ng-repeat="msg in messages" ng-class="msg.type">{{msg.text}}</p></section>
			</section>
		</section>

		<script src="/js/common.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
		<script src="/js/modules/ScrollGlue.js"></script>
		<!--script src="/js/services/SocketService.js"></script-->

		<script src="/js/controllers/GameController.js"></script>
		<script>
			/*
			 * TODO
			 *
			 * Change it so that there can be multiple games going - if both players disconnect, remove the game from the server
			 *     - when the first person connects, show a code and then the second person should use that code to connect to the game
			 *
			 * change the steal base buttons - trying to add an ngif directive (jpIf) as there is too much unnecessary HTML using a switch
			 * Add win graphics that appear when winner, and home run graphics too?
			 * look into seperating the socket factory stuff below into a seperate file
			 * Host up on nodejitsu/amazon - and see if we can get the game to work!
			 *
			 * improve the graphics - add popups etc
			 * add the tutorial popup to the game board
			 * Create the rest of the website - which will have a tutorial etc
			 *
			 * Allow the user to name their team for the game (and colour of deck/playing pieces)
			 * Slow the game down a bit - decisions seem to be too fast
			 * Add a span to represent the runner on base - animate them when they score
			 * Add a span to represent the ball and animate it to where it goes on the play
			 * Add the ability for users to roll their own dice
			 * Store the team in a database in the backend - show standings based on player locality (UK, USA, Kent UK leagues etc)
			 *
			 */
			var socket = io.connect('http://bbcg.local:1337');

			var app = angular.module('bbcgApp', ['ScrollGlue']);

			app.factory('socket', function ($rootScope) {
				var socket = io.connect();
				return {
					on: function (eventName, callback) {
						socket.on(eventName, function () {
							var args = arguments;
							$rootScope.$apply(function () {
								callback.apply(socket, args);
							});
						});
					},
					emit: function (eventName, data, callback) {
						socket.emit(eventName, data, function () {
							var args = arguments;
							$rootScope.$apply(function () {
								if (callback) {
									callback.apply(socket, args);
								}
							});
						})
					}
				};
			});
			
			function joinGame() {
				var gameID = document.querySelector('#gameID').value;
				socket.emit('joinGame', gameID);
			}
			
			function createGame() {
				socket.emit('createGame');
			}
		</script>
    </body>
</html>